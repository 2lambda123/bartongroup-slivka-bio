---
label: HMMsearch
classifiers: []

form:
  input-hmm:
    label: Input profile
    value:
      type: file
      required: yes
      media-type: application/hmmer

  input-database:
    label: Input database
    value:
      type: file
      required: yes
      media-type: application/fasta

  # Options controlling reporting thresholds
  rep-E:
    label: E-value threshold
    description: Report target sequences with a lower or equal E-value in
      per-target output. The default of 10 means that, on average, about
      10 false positives will be reported per query, so you can see the top
      of the noise.
    value:
      type: float
      required: no
      min: 0.0
      default: 10.0

  rep-T:
    label: Bit score threshold
    description: Use a bit score threshold for per-sequence output
      instead of and E-value (E-value threshold will be ignored).
      Report sequences having greater or equal bit score.
    value:
      type: float
      required: no

  repdom-E:
    label: Domains E-value threshold
    description: Report domains with lower of equal E-value
      in per-domain output, in addition to the top-scoring
      domain per significant sequence hit.
    value:
      type: float
      required: no
      min-exclusive: yes
      default: 10.0

  repdom-T:
    label: Domains bit score threshold
    description: Use a bit score threshold for per-domain output instead
      of an E-value threshold (domains E-value threshold will be
      ignored). Report domains with a greater or equal bit score
      in per-domain output, in addition to the top-scoring domain per
      significant sequence hit.
    value:
      type: float
      required: no

  # Options controlling inclusion threshold
  inc-E:
    label: Inclusion E-value threshold
    description: Include sequences having lower or equal E-value
      in subsequent iterations or final alignment output.
    value:
      type: float
      required: no
  
  inc-T:
    label: Inclusion bit score threshold
    description: Use a bit score threshold for per-sequence inclusion
      instead of an E-value threshold (inclusion E-value threshold
      will be ignored). Include sequences having greater or equal
      bit score.
    value:
      type: float
      required: no

  incdom-E:
    label: Domains inclusion E-value threshold
    description: Include domains with lower or equal E-value
      in subsequent iteration or final alignment output, in addition
      to the top-scoring domain per significant sequence hit.
    value:
      type: float
      required: no
      default: 0.001

  incdom-T:
    label: Domains inclusion bit score threshold
    description: Use a bit score threshold for per-domain inclusion
      instead of an E-value threshold (Domains inclusion E-value
      threshold will be ignored). Include domains a greater or equal
      bit score.
    value:
      type: float
      required: no

  # Options controlling model-specific thresholding
  cut-ga:
    label: Use GA cutoffs
    description: Use the GA (gathering) bit scores in the model to set
      per-sequence (GA1) and per-domain (GA2) reporting and inclusion
      thresholds. GA thresholds are generally considered to be reliable
      curated thresholds defining family membership.
    value:
      type: flag
      required: no

  cut-nc:
    label: Use NC cutoffs
    description: Use the NC (noise cutoff) bit score thresholds in
      the model to set per-sequence (NC1) and per-domain (NC2) reporting
      and inclusion thresholds. NC thresholds are generally considered to
      be the score of the highest-scoring known false positive.
    value:
      type: flag
      required: no

  cut-tc:
    label: Use TC cutoffs
    description: Use the TC (trusted cutoff) bit score thresholds in
      the model to set per-sequence (TC1) and per domain (TC2) reporting
      and inclusion thresholds. TC thresholds are generally considered
      to be the score of the lowest-scoring known true positive that is
      above all known false positives.
    value:
      type: flag
      required: no

  # Options controlling acceleration heuristics
  no-heuristic:
    label: Disable heuristic
    description: Maximum sensitivity. Turns off all filters,
      including the bias filter, and run full Forward/Backward
      postprocessing on every target. This increases sensitivity
      slightly, at a large cost in speed.
    value: 
      type: boolean
      required: no

  msv-threshold:
    label: MSV filter threshold
    description: First filter threshold; sets the P-value threshold
      for the MSV filter step. The default of 0.02 means that
      roughly 2% of the highest scoring nonhomologous targets are
      expected to pass the filter.
    value:
      type: float
      required: no
      min: 0.0
      default: 0.02

  vit-threshold:
    label: Viterbi filter threshold
    description: Second filter threshold; sets the P-value threshold
      for the Viterbi filter step.
    value:
      type: float
      required: no
      min: 0.0
      default: 0.001

  fwd-threshold:
    label: Forward filter threshold
    description: Third filter threshold; set the P-value threshold
      for the Forward filter step.
    value:
      type: float
      required: no
      min: 0.0
      default: 1.0e-5

  no-bias:
    label: Disable bias filter
    description: Turns off the bias filter. This increases sensitivity
      somewhat, but can come at a high cost in speed, especially
      if the query has biased residue composition (such as
      repetitive sequence region, or if is a membrane protein
      with large regions of hydrophobicity). Without the bias filter,
      too many sequences may pass the filter with biased queries,
      leading to slower than expected performance as the computationally
      intensive Forward/Backward algorithms should an abnormally
      heavy load.
    value: 
      type: boolean
      required: no

command:
  baseCommand: hmmsearch

  inputs:
    _output:
      arg: -o $(value)
      value: hmmsearch.out
    _msa_output:
      arg: -A $(value)
      value: msa.output.sto

    rep-E:
      arg: -E $(value)
      type: number
    rep-T:
      arg: -T $(value)
      type: number
    repdom-E:
      arg: --domE $(value)
      type: number
    repdom-T:
      arg: --domT $(value)
      type: number

    inc-E:
      arg: --incE $(value)
      type: number
    inc-T:
      arg: --incT $(value)
      type: number
    incdom-E:
      arg: --incdomE $(value)
      type: number
    incdom-T:
      arg: --incdomT $(value)
      type: number

    cut-ga:
      arg: --cut_ga
      type: flag
    cut-nc:
      arg: --cut_nc
      type: flag
    cut-tc:
      arg: --cut_tc
      type: flag

    no-heuristics:
      arg: --max
      type: flag
    msv-threshold:
      arg: --F1 $(value)
      type: number
    vit-threshold:
      arg: --F2 $(value)
      type: number
    fwd-threshold:
      arg: --F3 $(value)
      type: number
    no-bias:
      arg: --nobias
      type: flag

    input-hmm:
      arg: $(value)
      type: file
    input-database:
      arg: $(value)
      type: file

  env:
    PATH: ${HOME}/miniconda3/envs/hmmer/bin:${PATH}

  outputs:
    output:
      path: hmmsearch.out
      media-type: text/plain
    msa-output:
      path: msa.output.sto
      media-type: application/stockholm
    log:
      path: stdout
      media-type: text/plain
    error-log:
      path: stderr
      media-type: text/plain

runners:
  default:
    class: SlivkaQueueRunner
...
  